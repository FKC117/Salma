<!-- Professional Table Display Partial -->
<div class="table-display-container">
    <div class="table-header">
        <div class="table-title">
            <h6><i class="bi bi-table"></i> Data Table</h6>
            <span class="table-meta">
                <span id="tableRowCount">0</span> rows × <span id="tableColCount">0</span> columns
            </span>
        </div>
        <div class="table-actions">
            <div class="btn-group" role="group">
                <button class="btn btn-sm btn-outline-secondary" onclick="sortTable(this)" data-sort="none">
                    <i class="bi bi-arrow-down-up"></i> Sort
                </button>
                <button class="btn btn-sm btn-outline-secondary" onclick="filterTable(this)">
                    <i class="bi bi-funnel"></i> Filter
                </button>
                <button class="btn btn-sm btn-outline-secondary" onclick="exportTable(this, 'csv')">
                    <i class="bi bi-file-earmark-spreadsheet"></i> CSV
                </button>
                <button class="btn btn-sm btn-outline-secondary" onclick="exportTable(this, 'json')">
                    <i class="bi bi-file-earmark-code"></i> JSON
                </button>
                <button class="btn btn-sm btn-outline-secondary" onclick="exportTable(this, 'pdf')">
                    <i class="bi bi-file-earmark-pdf"></i> PDF
                </button>
                <button class="btn btn-sm btn-outline-secondary" onclick="fullscreenTable(this)">
                    <i class="bi bi-arrows-fullscreen"></i> Fullscreen
                </button>
            </div>
        </div>
    </div>
    
    <div class="table-content">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm" id="dataTable">
                <thead class="table-dark">
                    <tr id="tableHeader">
                        <!-- Dynamic headers will be inserted here -->
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Dynamic rows will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="table-footer">
        <div class="table-pagination">
            <div class="pagination-info">
                Showing <span id="showingStart">1</span> to <span id="showingEnd">10</span> of <span id="totalRows">0</span> entries
            </div>
            <div class="pagination-controls">
                <button class="btn btn-sm btn-outline-secondary" onclick="previousPage()" id="prevBtn" disabled>
                    <i class="bi bi-chevron-left"></i> Previous
                </button>
                <span class="pagination-numbers" id="paginationNumbers">
                    <!-- Page numbers will be inserted here -->
                </span>
                <button class="btn btn-sm btn-outline-secondary" onclick="nextPage()" id="nextBtn">
                    Next <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
        <div class="table-settings">
            <div class="form-group">
                <label for="rowsPerPage" class="form-label-sm">Rows per page:</label>
                <select class="form-select form-select-sm" id="rowsPerPage" onchange="changeRowsPerPage()">
                    <option value="10">10</option>
                    <option value="25" selected>25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="all">All</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Table Filter Modal -->
<div class="modal fade" id="tableFilterModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-funnel"></i> Filter Table</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="filterControls">
                    <!-- Dynamic filter controls will be inserted here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                <button type="button" class="btn btn-outline-danger" onclick="clearFilters()">Clear All</button>
            </div>
        </div>
    </div>
</div>

<!-- Table Fullscreen Modal -->
<div class="modal fade" id="tableFullscreenModal" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-table"></i> Table View - Fullscreen</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="fullscreenTableContainer">
                    <!-- Fullscreen table will be inserted here -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Professional Table Management System
class ProfessionalTableManager {
    constructor() {
        this.currentData = [];
        this.filteredData = [];
        this.currentPage = 1;
        this.rowsPerPage = 25;
        this.sortColumn = null;
        this.sortDirection = 'asc';
        this.filters = {};
        this.originalTable = null;
    }
    
    // Initialize table with data
    initializeTable(tableElement, data) {
        this.originalTable = tableElement;
        this.currentData = data;
        this.filteredData = [...data];
        this.renderTable();
        this.updateTableMeta();
    }
    
    // Render the table
    renderTable() {
        const headerRow = document.getElementById('tableHeader');
        const body = document.getElementById('tableBody');
        
        if (this.filteredData.length === 0) {
            headerRow.innerHTML = '<th colspan="100%" class="text-center text-muted">No data available</th>';
            body.innerHTML = '';
            return;
        }
        
        // Get headers from first row
        const headers = Object.keys(this.filteredData[0]);
        
        // Render header
        headerRow.innerHTML = headers.map((header, index) => `
            <th scope="col" class="sortable" data-column="${index}" onclick="sortByColumn(${index})">
                ${header}
                <i class="bi bi-arrow-down-up sort-icon"></i>
            </th>
        `).join('');
        
        // Render body with pagination
        this.renderTableBody();
    }
    
    // Render table body with pagination
    renderTableBody() {
        const body = document.getElementById('tableBody');
        const startIndex = (this.currentPage - 1) * this.rowsPerPage;
        const endIndex = this.rowsPerPage === 'all' ? this.filteredData.length : startIndex + this.rowsPerPage;
        const pageData = this.filteredData.slice(startIndex, endIndex);
        
        body.innerHTML = pageData.map(row => `
            <tr>
                ${Object.values(row).map(cell => `
                    <td>${this.formatCellValue(cell)}</td>
                `).join('')}
            </tr>
        `).join('');
        
        this.updatePagination();
    }
    
    // Format cell value
    formatCellValue(value) {
        if (value === null || value === undefined) {
            return '<span class="text-muted">—</span>';
        }
        
        if (typeof value === 'number') {
            return value.toLocaleString();
        }
        
        if (typeof value === 'boolean') {
            return value ? '<i class="bi bi-check-circle text-success"></i>' : '<i class="bi bi-x-circle text-danger"></i>';
        }
        
        if (typeof value === 'string' && value.length > 50) {
            return `<span title="${this.escapeHtml(value)}">${this.escapeHtml(value.substring(0, 50))}...</span>`;
        }
        
        return this.escapeHtml(String(value));
    }
    
    // Update table metadata
    updateTableMeta() {
        document.getElementById('tableRowCount').textContent = this.filteredData.length;
        document.getElementById('tableColCount').textContent = this.filteredData.length > 0 ? Object.keys(this.filteredData[0]).length : 0;
    }
    
    // Update pagination
    updatePagination() {
        const totalRows = this.filteredData.length;
        const totalPages = this.rowsPerPage === 'all' ? 1 : Math.ceil(totalRows / this.rowsPerPage);
        const startRow = this.rowsPerPage === 'all' ? 1 : (this.currentPage - 1) * this.rowsPerPage + 1;
        const endRow = this.rowsPerPage === 'all' ? totalRows : Math.min(this.currentPage * this.rowsPerPage, totalRows);
        
        document.getElementById('showingStart').textContent = startRow;
        document.getElementById('showingEnd').textContent = endRow;
        document.getElementById('totalRows').textContent = totalRows;
        
        // Update pagination buttons
        document.getElementById('prevBtn').disabled = this.currentPage === 1;
        document.getElementById('nextBtn').disabled = this.currentPage === totalPages;
        
        // Update page numbers
        this.renderPageNumbers(totalPages);
    }
    
    // Render page numbers
    renderPageNumbers(totalPages) {
        const container = document.getElementById('paginationNumbers');
        let html = '';
        
        const startPage = Math.max(1, this.currentPage - 2);
        const endPage = Math.min(totalPages, this.currentPage + 2);
        
        for (let i = startPage; i <= endPage; i++) {
            html += `<button class="btn btn-sm ${i === this.currentPage ? 'btn-primary' : 'btn-outline-secondary'}" 
                           onclick="goToPage(${i})">${i}</button>`;
        }
        
        container.innerHTML = html;
    }
    
    // Sort by column
    sortByColumn(columnIndex) {
        const headers = Object.keys(this.filteredData[0]);
        const column = headers[columnIndex];
        
        if (this.sortColumn === column) {
            this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
        } else {
            this.sortColumn = column;
            this.sortDirection = 'asc';
        }
        
        this.filteredData.sort((a, b) => {
            const aVal = a[column];
            const bVal = b[column];
            
            if (aVal === bVal) return 0;
            
            const comparison = aVal < bVal ? -1 : 1;
            return this.sortDirection === 'asc' ? comparison : -comparison;
        });
        
        this.currentPage = 1;
        this.renderTable();
        this.updateSortIcons();
    }
    
    // Update sort icons
    updateSortIcons() {
        const headers = document.querySelectorAll('.sortable');
        headers.forEach((header, index) => {
            const icon = header.querySelector('.sort-icon');
            const column = Object.keys(this.filteredData[0])[index];
            
            if (this.sortColumn === column) {
                icon.className = `bi ${this.sortDirection === 'asc' ? 'bi-arrow-up' : 'bi-arrow-down'} sort-icon`;
            } else {
                icon.className = 'bi bi-arrow-down-up sort-icon';
            }
        });
    }
    
    // Export table data
    exportTable(format) {
        const data = this.filteredData;
        const headers = Object.keys(data[0]);
        
        switch (format) {
            case 'csv':
                this.exportToCSV(data, headers);
                break;
            case 'json':
                this.exportToJSON(data);
                break;
            case 'pdf':
                this.exportToPDF(data, headers);
                break;
        }
    }
    
    // Export to CSV
    exportToCSV(data, headers) {
        const csvContent = [
            headers.join(','),
            ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
        ].join('\n');
        
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `table_export_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        URL.revokeObjectURL(url);
    }
    
    // Export to JSON
    exportToJSON(data) {
        const jsonContent = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonContent], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `table_export_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }
    
    // Export to PDF (placeholder)
    exportToPDF(data, headers) {
        alert('PDF export functionality will be implemented with a PDF generation library');
    }
    
    // Escape HTML
    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
}

// Global functions for table management
let tableManager = new ProfessionalTableManager();

function sortByColumn(columnIndex) {
    tableManager.sortByColumn(columnIndex);
}

function goToPage(page) {
    tableManager.currentPage = page;
    tableManager.renderTableBody();
}

function previousPage() {
    if (tableManager.currentPage > 1) {
        tableManager.currentPage--;
        tableManager.renderTableBody();
    }
}

function nextPage() {
    const totalPages = Math.ceil(tableManager.filteredData.length / tableManager.rowsPerPage);
    if (tableManager.currentPage < totalPages) {
        tableManager.currentPage++;
        tableManager.renderTableBody();
    }
}

function changeRowsPerPage() {
    const select = document.getElementById('rowsPerPage');
    tableManager.rowsPerPage = select.value === 'all' ? 'all' : parseInt(select.value);
    tableManager.currentPage = 1;
    tableManager.renderTableBody();
}

function exportTable(button, format) {
    tableManager.exportTable(format);
}

function fullscreenTable(button) {
    const modal = new bootstrap.Modal(document.getElementById('tableFullscreenModal'));
    const container = document.getElementById('fullscreenTableContainer');
    
    // Clone the table for fullscreen
    const table = document.getElementById('dataTable').cloneNode(true);
    table.classList.add('table-lg');
    container.innerHTML = '';
    container.appendChild(table);
    
    modal.show();
}

function filterTable(button) {
    const modal = new bootstrap.Modal(document.getElementById('tableFilterModal'));
    modal.show();
}

function applyFilters() {
    // Filter implementation
    console.log('Applying filters...');
}

function clearFilters() {
    // Clear filters implementation
    console.log('Clearing filters...');
}

// Initialize table when content is detected
document.addEventListener('DOMContentLoaded', () => {
    // Auto-initialize tables in chat messages
    const tables = document.querySelectorAll('.table-container table');
    tables.forEach(table => {
        if (table.id !== 'dataTable') {
            // Convert existing table to professional format
            const data = convertTableToData(table);
            if (data.length > 0) {
                tableManager.initializeTable(table, data);
            }
        }
    });
});

function convertTableToData(table) {
    const rows = Array.from(table.querySelectorAll('tr'));
    if (rows.length < 2) return [];
    
    const headers = Array.from(rows[0].querySelectorAll('th, td')).map(cell => cell.textContent.trim());
    const data = [];
    
    for (let i = 1; i < rows.length; i++) {
        const cells = Array.from(rows[i].querySelectorAll('td'));
        if (cells.length === headers.length) {
            const row = {};
            headers.forEach((header, index) => {
                row[header] = cells[index].textContent.trim();
            });
            data.push(row);
        }
    }
    
    return data;
}
</script>
